"use strict";

var _require = require('path'),
    resolve = _require.resolve;

var _require2 = require('fs-extra'),
    readFileSync = _require2.readFileSync;

var adapter = require('../adapter');

var addFileToCompilation = require('../utils/addFileToCompilation');

var _require3 = require('miniapp-builder-shared'),
    getHighestPriorityPackageJSON = _require3.pathHelper.getHighestPriorityPackageJSON;

module.exports = function (compilation, _ref) {
  var target = _ref.target,
      command = _ref.command,
      rootDir = _ref.rootDir;
  var miniappRenderPackageJsonFile = getHighestPriorityPackageJSON('miniapp-render', rootDir);
  var sourceMiniappRenderFile = resolve(miniappRenderPackageJsonFile, '..', 'dist', adapter[target].fileName, command === 'build' ? 'index.min.js' : 'index.js');
  addFileToCompilation(compilation, {
    filename: 'render.js',
    content: readFileSync(sourceMiniappRenderFile, 'utf-8'),
    command: command,
    target: target
  });
};