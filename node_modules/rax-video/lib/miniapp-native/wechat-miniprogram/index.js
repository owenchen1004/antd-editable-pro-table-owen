"use strict";

var _fmtEvent = _interopRequireDefault(require("./fmtEvent"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
var randomVideoID = function () {
  return '__rax_video_' + Date.now();
};
var noop = function () {};
Component({
  data: {
    _id: ''
  },
  properties: {
    src: {
      type: String,
      value: ''
    },
    controls: {
      type: Boolean,
      value: true
    },
    muted: {
      type: Boolean,
      value: false
    },
    autoPlay: {
      type: Boolean,
      value: false
    },
    playControl: {
      type: String,
      value: '',
      observer: function observer(newVal) {
        if (!(newVal === 'pause' || newVal === 'play')) {
          return;
        }
        if (this.videoContext) {
          this.switchPlayStatus(newVal);
        }
      }
    },
    loop: {
      type: Boolean,
      value: false
    },
    onEnded: {
      type: Function,
      value: noop
    },
    className: {
      type: String,
      value: ''
    },
    styleSheet: {
      type: String,
      value: ''
    },
    onClick: {
      type: Function,
      value: noop
    },
    componentId: {
      type: String,
      value: ''
    },
    poster: {
      type: String,
      value: ''
    },
    showMuteBtn: {
      type: Boolean,
      value: true
    },
    showPlayBtn: {
      type: Boolean,
      value: true
    },
    showFullscreenBtn: {
      type: Boolean,
      value: true
    },
    showCenterPlayBtn: {
      type: Boolean,
      value: true
    },
    objectFit: {
      type: String,
      value: 'contain'
    }
  },
  options: {
    styleIsolation: 'apply-shared'
  },
  attached: function attached() {
    var _this$properties = this.properties,
      playControl = _this$properties.playControl,
      componentId = _this$properties.componentId;
    var _id = componentId || randomVideoID();
    if (playControl) {
      this.videoContext = wx.createVideoContext(_id);
      this.switchPlayStatus(playControl);
    }
    this.setData({
      _id: _id
    });
  },
  methods: {
    onClick: function onClick(e) {
      var event = (0, _fmtEvent.default)(this.properties, e);
      this.triggerEvent('onClick', event);
    },
    onEnded: function onEnded(e) {
      var event = (0, _fmtEvent.default)(this.properties, e);
      this.triggerEvent('onEnded', event);
    },
    switchPlayStatus: function switchPlayStatus(playControl) {
      if (playControl === 'play') {
        this.videoContext.play();
      } else if (playControl === 'pause') {
        this.videoContext.pause();
      }
    }
  }
});