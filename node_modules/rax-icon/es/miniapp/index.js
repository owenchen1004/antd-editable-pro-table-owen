import fmtEvent from './fmtEvent';

var noop = function () {};

console.warn('组件所依赖的 rax-icon 版本较旧，请尽快重新构建发布该组件');
Component({
  data: {
    styleSheet: '',
    isImage: false
  },
  // @ts-ignore
  props: {
    className: '',
    style: '',
    source: {
      uri: '',
      codePoint: ''
    },
    fontFamily: '',
    onClick: noop
  },
  deriveDataFromProps: function deriveDataFromProps(nextProps) {
    this.initIcon(nextProps);
  },
  didMount: function didMount() {
    if (!my.canIUse('component2')) {
      this.initIcon();
    }
  },
  didUpdate: function didUpdate() {
    if (!my.canIUse('component2')) {
      this.initIcon();
    }
  },
  methods: {
    initIcon: function initIcon(nextProps) {
      var props = nextProps || this.props;

      var _ref = props.source || {},
          uri = _ref.uri,
          codePoint = _ref.codePoint;

      var fontFamily = props.fontFamily,
          _props$style = props.style,
          style = _props$style === void 0 ? '' : _props$style;

      if (uri && !codePoint && !fontFamily) {
        // use uri as image url
        this.setData({
          isImage: true,
          styleSheet: style
        });
        return;
      }

      if (!fontFamily) {
        // need't load font, just set style
        this.setData({
          styleSheet: style
        });
        return;
      } // load font and set style prop with new font-family


      if (typeof my.loadFontFace === 'function') {
        // loadFontFace only work for current page
        my.loadFontFace({
          family: fontFamily,
          source: "url('" + uri + "')"
        });
      } else {
        // some container (such as dingtalk's v1 engine) not support loadFontFace
        console.warn('Your container may not support my.loadFontFace! Please check it and use local fontfamily.');
      } // styleSheet receives string, and style is formated to string in compile stage.


      this.setData({
        styleSheet: "font-family:" + fontFamily + ";" + style
      });
    },
    onTap: function onTap(e) {
      var event = fmtEvent(this.props, e);

      if (this.props.onClick !== noop) {
        this.props.onClick(event);
      }
    }
  }
});