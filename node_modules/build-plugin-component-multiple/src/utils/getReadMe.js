const chalk = require('chalk');
const fse = require('fs-extra');
const { markdownParser } = require('./markdownHelper');
const generateAPI = require('./generators/generateAPI');
const getReadmeFile = require('./getReadMeFile');

module.exports = function (rootDir, componentName, isSingle = false) {
  const apiMarkdownContent = generateAPI(rootDir, componentName, isSingle);
  const readmeFilePath = getReadmeFile(rootDir, componentName, isSingle);

  if (fse.existsSync(readmeFilePath)) {
    const readmeContent = fse.readFileSync(readmeFilePath, 'utf-8');
    const { meta, content } = markdownParser(readmeContent, {
      sliceApi: true,
      snippets: {
        api: apiMarkdownContent,
      },
    });

    return { meta, content, filePath: readmeFilePath };
  } else {
    console.log(chalk.yellowBright(`未找到组件 ${componentName} 的 README 文件`));
  }

  return {};
};
