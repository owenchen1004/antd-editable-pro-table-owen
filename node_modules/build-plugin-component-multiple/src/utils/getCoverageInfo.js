/**
 * 获取组件覆盖率统计
 * 来源： ./coverage/fusion-summary.json
 */

const path = require('path');
const fse = require('fs-extra');

module.exports = (rootDir) => {
  const filePath = path.resolve(rootDir, './coverage/fusion-summary.json');
  const ret = {};

  if (fse.existsSync(filePath)) {
    const coverage = require(filePath);

    if (coverage && coverage.components) {
      Object.keys(coverage.components).forEach((componentName) => {
        if (coverage.components[componentName].lines && coverage.components[componentName].lines.pct) {
          ret[componentName] = coverage.components[componentName].lines.pct || 0;
        }
      });
    }
  }

  return ret;
};
