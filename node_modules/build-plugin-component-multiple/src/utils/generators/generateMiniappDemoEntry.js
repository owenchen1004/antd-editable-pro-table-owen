const path = require('path');
const _flatten = require('lodash/flatten');
const generateEntry = require('./generateEntry');
const getDirs = require('../getDirs');

module.exports = function (rootDir, components = [], homePagePath) {
  const { TMP_FILE_DIR } = getDirs(rootDir);
  const outputFilePath = path.resolve(TMP_FILE_DIR, 'bundle.jsx');
  const demos = _flatten(components.map((item) => item.demos));

  generateEntry({
    template: 'runtimeMiniappDemoEntry.hbs',
    outputPath: outputFilePath,
    params: {
      demos: [
        {
          componentPascalName: '',
          demoPascalName: 'Home',
          filePath: homePagePath,
        },
        ...demos,
      ],
    },
  });

  return outputFilePath;
};
