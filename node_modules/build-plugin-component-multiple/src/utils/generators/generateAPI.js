/**
 * 根据财鲸的文档能力，生成对应的 markdown api table
 */
const path = require('path');
const fse = require('fs-extra');
const { whaleDocgen } = require('whale-component-docgen');

// 基于 types 生成 API markdown 片段
module.exports = function (rootDir, componentName, isSingle) {
  const path1 = path.resolve(rootDir, 'src/index.ts');
  // 如果无 components
  const path2 = path.resolve(rootDir, `src/${componentName}/index.ts`);
  // 如果在 components 中
  const path3 = path.resolve(rootDir, `src/components/${componentName}/index.ts`);

  let entryPath = '';

  if (isSingle && fse.existsSync(path1)) {
    entryPath = path1;
  } else if (fse.existsSync(path2)) {
    entryPath = path2;
  } else if (fse.existsSync(path3)) {
    entryPath = path3;
  }

  if (entryPath) {
    const apiTable = whaleDocgen(entryPath, {
      ingoreFileNames: ['@types/react', '@types/rax', 'typescript/lib'],
    });

    return '## API \n' + apiTable;
  }

  return '';
};
