/**
 * 统一构建 hbs
 * @type {module:path}
 */
const path = require('path');
const fse = require('fs-extra');
const hbs = require('handlebars');

module.exports = function generateEntryJS({ template, templatePath, outputPath, params }) {
  const hbsTemplatePath = templatePath || path.join(__dirname, `../../template/${template}`);
  const hbsTemplateContent = fse.readFileSync(hbsTemplatePath, 'utf-8');
  hbs.registerHelper('camelCased', (str) => {
    return str.replace(/-([a-z])/g, (math) => math[1].toUpperCase());
  });
  hbs.registerHelper('escape', (str) => {
    return (
      (str || '')
        .replace(/`/g, '&#x60;')
        // escape $ for `$` make sense
        .replace(/\$/g, '&#36;')
    );
  });
  const compileTemplateContent = hbs.compile(hbsTemplateContent);
  const jsTemplateContent = compileTemplateContent(params);

  fse.ensureFileSync(outputPath);
  fse.writeFileSync(outputPath, jsTemplateContent);
};
