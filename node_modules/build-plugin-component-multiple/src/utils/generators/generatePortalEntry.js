/**
 * 生成调试门户页所需 js
 */
const { join } = require('path');
const generateEntry = require('./generateEntry');
const getReadme = require('../getReadMe');
const getDirs = require('../getDirs');

module.exports = (context, componentName, demos) => {
  const { rootDir, command, userConfig, pkg } = context;
  const { meta } = getReadme(rootDir, componentName);
  const { targets } = userConfig;
  const { TMP_FILE_DIR } = getDirs(rootDir);
  const outputPath = join(TMP_FILE_DIR, 'rax-portal.js');

  generateEntry({
    template: 'portal-data.hbs',
    outputPath,
    params: {
      demos,
      meta,
      command,
      targets,
      title: meta.title || pkg.name,
    },
  });

  return outputPath;
};
