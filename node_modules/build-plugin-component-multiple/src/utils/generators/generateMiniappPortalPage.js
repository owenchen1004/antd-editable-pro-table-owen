/**
 * 生成用于小程序预览的引导页
 */
const path = require('path');
const fse = require('fs-extra');
const generateEntry = require('./generateEntry');
const getGroupData = require('../getGroupData');

module.exports = function (components, tempDir, pkg) {
  const outputFilePath = path.join(tempDir, 'miniapp-portal.js');

  const groupData = getGroupData(components);

  // 生成数据
  fse.writeJsonSync(path.join(tempDir, 'data.json'), groupData, { space: '  ' });
  // 首页首页样式
  fse.copySync(path.join(__dirname, `../../template/home/index.css`), path.join(tempDir, 'index.css'));

  generateEntry({
    template: 'home/index.js',
    outputPath: outputFilePath,
    params: {
      logo: pkg.logo || '',
      description: pkg.description || '',
      version: pkg.version,
    },
  });

  return outputFilePath;
};
