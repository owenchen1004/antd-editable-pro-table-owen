"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderBlockPackageJSON = void 0;
const mdast_builder_1 = require("mdast-builder");
const qs = require("qs");
const remoteUrl_1 = require("../../utils/remoteUrl");
const renderBadges_1 = require("./renderBadges");
const renderBlockPackageJSON = (packageJSON, source) => [
    mdast_builder_1.heading(1, mdast_builder_1.text(packageJSON.name)),
    mdast_builder_1.paragraph(renderBadges(packageJSON, source)),
    mdast_builder_1.paragraph(mdast_builder_1.text(packageJSON.description)),
    mdast_builder_1.heading(2, mdast_builder_1.text('使用方法')),
    packageJSON.blockConfig &&
        mdast_builder_1.paragraph(mdast_builder_1.link('https://yuque.antfin-inc.com/bp-xt-dt/battle/blocks_used_in_iceworks', '如何iceworks中使用区块', mdast_builder_1.text('如何iceworks中使用区块'))),
    mdast_builder_1.heading(2, mdast_builder_1.text('API')),
].filter((vo) => vo);
exports.renderBlockPackageJSON = renderBlockPackageJSON;
const renderBadges = (packageJSON, source) => {
    const remoteUrl = remoteUrl_1.getGitRemoteUrl(source);
    const materialConfig = packageJSON.blockConfig;
    return [
        renderBadges_1.tnpmVersionBadge(packageJSON.name, packageJSON.version),
        mdast_builder_1.text('\n'),
        renderBadges_1.tnpmDownloadsBadge(packageJSON.name),
        mdast_builder_1.text('\n'),
        remoteUrl &&
            renderBadges_1.gitlabBugIssueBadge(`${remoteUrl}/issues/new?${qs.stringify({
                issue: {
                    title: `[Bug]${(materialConfig === null || materialConfig === void 0 ? void 0 : materialConfig.name) || packageJSON.name}: `,
                    description: [
                        '### 环境信息',
                        '',
                        `- 区块名称： ${materialConfig === null || materialConfig === void 0 ? void 0 : materialConfig.title}`,
                        `- 区块版本： ${packageJSON.version}`,
                        '',
                        '<!-- 在此描述Bug -->',
                        '',
                        '### 当前行为',
                        '',
                        '### 期望行为',
                        '',
                        '### 复现方式',
                        '',
                    ].join('\n'),
                    issuable_template: 'bug',
                },
            })}`, '提Bug'),
        remoteUrl && mdast_builder_1.text('\n'),
        remoteUrl &&
            renderBadges_1.gitlabEnhancementIssueBadge(`${remoteUrl}/issues/new?${qs.stringify({
                issue: {
                    title: `[需求]${(materialConfig === null || materialConfig === void 0 ? void 0 : materialConfig.name) || packageJSON.name}: `,
                    description: [
                        '### 环境信息',
                        '',
                        `- 区块名称: ${materialConfig === null || materialConfig === void 0 ? void 0 : materialConfig.name} ${materialConfig === null || materialConfig === void 0 ? void 0 : materialConfig.title}`,
                        `- 区块版本: ${packageJSON.version}`,
                        '',
                        '<!-- 在此描述需求 -->',
                        '',
                        '### 期望行为',
                        '',
                        '### UI截图(如果有设计稿请附上)',
                        '',
                    ].join('\n'),
                    issuable_template: 'enhancement',
                },
            })}`, '提需求'),
    ].filter((vo) => vo);
};
//# sourceMappingURL=renderBlockPackageJSON.js.map